{% extends 'base.html.twig' %}

{% block title %}Page de {{ user.fullName }}{% endblock %}

{% block body %}

<div class="container-fluid mt-0">

    <div class="row account-header">

        <div class="col-12 px-0">
            <div class="card my-card no-border my-box pb-0 mt-0 no-br o-visible">
                
                <div class="mt-4 text-center">

                    <div class="account-picture">
                        {% include '_picture.html.twig' with {'user': user, 'class': 'large'} %}
                        
                        {% if user == app.user %}
                        <a href="{{ path('account_picture_edit') }}" class="btn p-0"><i class="fas fa-camera"></i></a>
                        {% endif %}

                    </div>

                    <div class="account-name">{{ user.fullName }}
                    </div>
                    <div class="account-poste">
                        {{ user.poste }}

                        {% set from_user_admin = false %}
                            {% for role in user.roles %} 
                                {% if role == 'ROLE_ADMIN' %}{% set from_user_admin = true %}{% endif %}
                            {% endfor %}
                        
                        {% if from_user_admin %}
                            {# <span class="badge badge-admin"></span> #}
                            <i class="fas fa-user-shield ml-2 violet"></i>
                        {% endif %}    
                    </div>

                    <div class="row justify-content-center">
                        <div class="col-md-auto">
                            <div class="card my-card mx-4 mt-4 stat-card no-border">

                                    {% set counter = filesObsolete|length + filesWellObsolete|length + filesUpToDate|length %}

                                    <table class="my-table no-border w-100">
                                        <tr>
                                            <td class="text-center stat">{{ counter }} </td>
                                            <td class="text-center stat">{{ user.subCategories|length }}</td>
                                            
                                            {% if user.adminGroupes|length > 0 %}
                                                <td class="text-center stat">{{ user.adminGroupes|length }}</td>
                                            {% endif %}

                                        </tr>
                                        <tr>
                                            <td class="text-center txt">Fiches</td>
                                            <td class="text-center txt">Sous-catégories</td>

                                            {% if user.adminGroupes|length > 0 %}
                                            <td class="text-center txt">Dossiers suivis</td>
                                            {% endif %}

                                        </tr>

                                        
                                    </table>
                            
                            </div>
                        </div>
                    </diV>


                </div>
                


                {# Header #}
                {# <div class="w-100 header-profile-card my-box">

                    <div class="row">
                        <div class="col-12 col-md-auto">
                            <div style="width: 180px;" class="text-center">

                                <div class="account-picture my-box">
                                    {% include '_picture.html.twig' with {'user': user, 'class': 'large'} %}
                                </div>

                            </div>
                        </div>
                        <div class="col-md account-title">

                                <div class="w-100 account-name">{{ user.fullName }}</div>
                                <div class="w-100 account-poste">

                                    {{ user.poste }} <span class="badge">{{ user.groupe }}</span>
                                    
                                    {% if is_granted('ROLE_ADMIN') %}
                                    
                                        <span class="badge">Administrateur</span>

                                    {% endif %}

                                </div>

                                <div class="stat-table">

                                    <table class="my-table no-border">
                                        <tr>
                                            <td class="text-center stat">{{ user.sheets|length + user.documents|length}} </td>
                                            <td class="text-center stat">{{ user.subCategories|length }}</td>
                                            
                                            {% if user.adminGroupes|length > 0 %}
                                                <td class="text-center stat">{{ user.adminGroupes|length }}</td>
                                            {% endif %}

                                        </tr>
                                        <tr>
                                            <td class="text-center pb-3 px-2 pt-0 op-70 txt">Fiches / Documents</td>
                                            <td class="text-center pb-3 px-3 pt-0 op-70 txt">Sous-catégories</td>
                                            {% if user.adminGroupes|length > 0 %}
                                            <td class="text-center pb-3 px-3 pt-0 op-70 txt">Dossiers suivis</td>
                                            {% endif %}
                                        </tr>

                                        
                                    </table>

                                </div>
                        
                        </div>
                    
                    </div>
                
                </div> #}
                
                <div class="account-nav container px-4">
                    <hr class="mt-0 mb-0">
                
                    <nav>
                        <div class="nav nav-tabs no-border" id="nav-tab" role="tablist">
                            <a class="nav-item nav-link active btn no-br mt-1" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">Accueil</a>
                            <a class="nav-item nav-link btn no-br mt-1" id="nav-groupe-tab" data-toggle="tab" href="#nav-groupe" role="tab" aria-controls="nav-groupe" aria-selected="false">Groupe</a>
                            <a class="nav-item nav-link btn no-br mt-1" id="nav-event-tab" data-toggle="tab" href="#nav-event" role="tab" aria-controls="nav-event" aria-selected="false">Evenements</a>

                            {% if is_granted("ROLE_ADMIN") and user == app.user %}

                                <a class="nav-item nav-link btn no-br mt-1" id="nav-admin-tab" data-toggle="tab" href="#nav-admin" role="tab" aria-controls="nav-admin" aria-selected="false">Suivi de la documentation</a>

                            {% endif %}
                            
                            {# <span class="py-2 ml-auto">
                                <a href="{{ path('account_picture_edit', { 'id': user.id }) }}" class="btn btn-my-secondary float-right py-2 px-3 mt-0 no-border">Modifier mon profil</a>
                            </span> #}
                            {% if user == app.user %}
                                <span class="dropdown ml-auto mr-2">
                                    <button class="btn btn-my-secondary px-3" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        {# <i class="uil uil-setting op-70"></i> #}
                                        <i class="fas fa-pen mr-2"></i>
                                        Modifier mon profil
                                    </button>
                                    <div class="dropdown-menu my-dropdown dropdown-menu-right no-border my-box pt-0" aria-labelledby="dropdownMenuButton">
                                        <a class="dropdown-item pl-3" href="{{ path('account_password') }}"><i class="fas fa-unlock-alt my-rounded"></i></span> Mot de passe</a>
                                        <a class="dropdown-item pl-3" href="{{ path('account_infos') }}"><i class="fas fa-info my-rounded"></i></span> Informations personnelles</a>
                                    </div>
                                </span>

                            {% endif %}
                            
                        
                        </div>
                        
                    </nav>
                    
                    

                    
                    
                
                </div>
                    
        
        
            </div>
        
        </div>

    </div>

</div>
<div class="container mt-0">
    <div class="row">

        {# Sidebar #}
        <div class="col-12 col-md-auto mt-3">
            <div style="width: 350px;" class="account-sidebar">

                <div class="card my-card no-border my-box mt-2 infos-card">

                    <div class="card-body p-4">

                        <h5>A propos</h5>

                        <div class="mb-2">
                            <table class="my-table no-border">

                                {# Antenne #}
                                <tr>
                                    <td class="info-icon">
                                        <i class="fas fa-map-marker-alt"></i>
                                    </td>
                                    <td class="info-content">
                                        <span class="info">{{ user.antenne }}</span>
                                    </td>
                                </tr>

                                {# Phone Number #}

                                <tr>
                                    <td class="info-icon">
                                        <i class="fas fa-phone-alt"></i>
                                    </td>
                                    <td class="info-content">
                                       <span class="info">{% if user.phoneNumber %}  {{ user.phoneNumber }} {% else %} - {% endif %}</span><span class="badge secondary p-1 ml-1 align-middle">{{ user.directNumber }}</span><br>
                                       {% if user.proNumber %} <span class="info">{{ user.proNumber }}</span> (pro)  {% endif %}
                                    </td>
                                </tr>
                                
                                {# Email #}
                                <tr>
                                    <td class="info-icon">
                                        <i class="fas fa-envelope"></i>
                                    </td>
                                    <td class="info-content">
                                       <span class="info"><a class="violet" href="mailto:{{user.email}}">{{ user.email }}</a></span>
                                    </td>
                                </tr>

                                {# Introduction #}
                                {% if user.introduction %}

                                    <tr>
                                        <td class="info-icon">
                                            <i class="fas fa-briefcase"></i>
                                        </td>
                                        <td class="info-content">
                                        <span class="info">{{ user.introduction }}</span>
                                        </td>
                                    </tr>

                                {% endif %}

                                {# SubCategories #}
                                <tr>
                                    <td class="info-icon">
                                        <i class="fas fa-folder-open"></i>
                                    </td>
                                    <td class="info-content">
                                        <span class="info">
                                            
                                            {% for sub in user.subCategories %}

                                                    <a href="{{ path('doc_show', { 'slug': sub.category.slug, 'sub_slug': sub.slug, 'sub_id': sub.id }) }}" class="black"><span class="violet">{{ sub }}</span></a>
                                                    {% if not loop.last %}
                                                    ,
                                                    {% endif %}


                                            {% endfor %}

                                            
                                        </span>
                                    </td>
                                </tr>

                                {# CreatedAt #}
                                <tr>
                                    <td class="info-icon">
                                        <i class="fas fa-clock"></i>
                                    </td>
                                    <td class="info-content">
                                       <span class="info">Membre depuis {{ user.createdAt|localizeddate('none', 'none', 'fr', null, 'MMMM Y')|capitalize }}</span>
                                    </td>
                                </tr>

                            </table>
                             
                        </div>

                    </div>      
                
                </div>


            </div>
        </div>


        {# Content #}
        <div class="col-12 col-md mt-4 account-content">

            <div class="tab-content" id="nav-tabContent">

                
                {# Home #}
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">

                    <div class="card my-card no-border my-box mt-0 mb-4 pb-0 o-visible">
                        <div class="card-body py-0">
                            
                            <div class="row">
                                <div class="col-4 pr-2">
                                    <h5 class="pt-4">Documentation</h5>
                                </div>
                                <div class="col-8 pl-2">
                                {% if user == app.user %}
                                    <div class="row">
                                        <div class="col-6 pr-1">
                                            {# <button data-toggle="modal" data-target="#subModalDocument" data-title="Nouveau document" class="btn btn-my-secondary w-100 mt-2">
                                                Importer un document
                                            </button> #}
                                            
                                        </div>
                                        <div class="col-6 pl-2">
                                            <button data-toggle="modal" data-target="#subModalSheet" data-title="Nouvelle fiche" class="btn btn-my-secondary w-100 mt-2">
                                                Créer une fiche
                                            </button>
                                        </div>
                                    </div>
                                {% endif %}
                                    

                                </div>
                                
                                <div class="col-12 px-2 account-nav">
                                    <hr class="mb-0 mt-1">

                                    {# <nav>
                                        <div class="nav nav-tabs no-border" id="nav-tab-2" role="tablist">
                                            <a class="nav-item w-50 nav-link active btn no-br mt-1" id="nav-online-tab" data-toggle="tab" href="#nav-online" role="tab" aria-controls="nav-online" aria-selected="true">En ligne</a>
                                            <a class="nav-item w-50 nav-link btn no-br mt-1" id="nav-draft-tab" data-toggle="tab" href="#nav-draft" role="tab" aria-controls="nav-draft" aria-selected="false">Brouillons ({{ drafts|length }})</a>
                                        </div>
                                    </nav> #}



                                    <nav>
                                        <div class="nav nav-tabs no-border" id="nav-tab" role="tablist">
                                            <a class="nav-item nav-link no-br px-4 btn active" id="nav-online-tab" data-toggle="tab" href="#nav-online" role="tab" aria-controls="nav-online" aria-selected="true">En ligne ({{ counter }})</a>
                                            
                                            {# {% if is_granted('ROLE_ADMIN') %}     #}
                                            {% if user == app.user %}
                                                <a class="nav-item nav-link no-br px-4 btn" id="nav-to-validate-tab" data-toggle="tab" href="#nav-to-validate" role="tab" aria-controls="nav-to-validate" aria-selected="false">En attente de validation ({{ filesToValidate|length }})</a>
                                                <a class="nav-item nav-link no-br px-4 btn" id="nav-to-correct-tab" data-toggle="tab" href="#nav-to-correct" role="tab" aria-controls="nav-to-correct" aria-selected="false">A corriger ({{ filesToCorrect|length }})</a>
                                                
                                                {# {% endif %} #}
                                                
                                                <a class="nav-item nav-link no-br px-4 btn" id="nav-draft-tab" data-toggle="tab" href="#nav-draft" role="tab" aria-controls="nav-draft" aria-selected="false">Brouillons ({{ drafts|length }})</a>
                                                
                                                <div class="dropdown float-right">
                                                    <button class="btn btn-my-secondary small px-2 py-2" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                        <i class="uil uil-ellipsis-v"></i>
                                                    </button>
                                                    <div class="dropdown-menu dropdown-menu-right my-dropdown " aria-labelledby="dropdownMenuButton">
                                                        <a class="dropdown-item pl-3" id="nav-archived-tab" data-toggle="tab" href="#nav-archived" role="tab" aria-controls="nav-archived" aria-selected="false">Archives ({{ filesArchived|length }})</a>
                                                    </div>
                                                </div>
                                            
                                            {% endif %}
                                        </div>
                                    </nav>
                                    
                                    
                                    
                                    
                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="nav-tabContent">

                        {# Online #}
                        <div class="tab-pane fade show active" id="nav-online" role="tabpanel" aria-labelledby="nav-online-tab">
                        
                        
                            {% if (filesObsolete|length + filesWellObsolete|length + filesUpToDate|length) > 0 %}

                                
                                {# Obsolète #}
                                {% for file in filesObsolete %}
                                    {% include 'documentation/_file.html.twig' %}
                                {% endfor %}

                                {# Bientôt obsolète #}
                                {% for file in filesWellObsolete %}
                                    {% include 'documentation/_file.html.twig' %}
                                {% endfor %}
                                
                                {# A jour #}
                                {% for file in filesUpToDate %}
                                    {% include 'documentation/_file.html.twig' %}
                                {% endfor %}

                            {% else %}

                                <p class="text my-4 text-center w-100">Aucune documentation en ligne</p>

                            {% endif %}
 
                        </div>
                        
                        {% if user == app.user %}

                            {# En attente de validation #}
                            <div class="tab-pane fade" id="nav-to-validate" role="tabpanel" aria-labelledby="nav-to-validate-tab">
                            
                                {% if filesToValidate|length > 0 %}
                            
                                    {# En attente de validation #}
                                    {% for file in filesToValidate %}
                                        {% include 'documentation/_file.html.twig' %}
                                    {% endfor %}

                                {% else %}

                                    <p class="text text-center">Aucune fiche en attente de validation</p>

                                {% endif %}
                            
                            </div>

                            {# A corriger #}
                            <div class="tab-pane fade" id="nav-to-correct" role="tabpanel" aria-labelledby="nav-to-correct-tab">
                            
                                {% if filesToCorrect|length > 0 %}
                            
                                    {# En attente de validation #}
                                    {% for file in filesToCorrect %}
                                        {% include 'documentation/_file.html.twig' %}
                                    {% endfor %}

                                {% else %}

                                    <p class="text text-center">Aucune fiche à corriger</p>

                                {% endif %}
                            
                            </div>

                            {# Draft #}
                            <div class="tab-pane fade" id="nav-draft" role="tabpanel" aria-labelledby="nav-draft-tab">
                            
                            
                            
                                {% for file in drafts %}
                                    {% include 'documentation/_file.html.twig' %}
                                {% endfor %}
                            
                            </div>

                             {# Archives #}
                            <div class="tab-pane fade" id="nav-archived" role="tabpanel" aria-labelledby="nav-archived-tab">
                            
                                {% if filesArchived|length > 0 %}
                            
                                    {# En attente de validation #}
                                    {% for file in filesArchived %}
                                        {% include 'documentation/_file.html.twig' %}
                                    {% endfor %}

                                {% else %}

                                    <p class="text text-center">Aucune fiche archivée</p>

                                {% endif %}
                            
                            </div>
                        {% endif %}
                    </div>


                </div>

                {# Groupe #}
                <div class="tab-pane fade" id="nav-groupe" role="tabpanel" aria-labelledby="nav-groupe-tab">


                    
                    <div class="row">

                        <div class="col-12">

                                <div class="card my-card no-border mt-0 my-box">

                                    <div class="card-body">
                                        <h5 class="mb-0">Groupe</h5>
                                        <p class="text">{{ user.groupe }}</p>

                                            <div class="row px-3">

                                                {% for u in user.groupe.users %}

                                                    {% if u != user %}

                                                       
                                                        <div class="col-6 px-1">
                                                            <a href="{{ path('user_show', {'slug': u.slug })}}">
                                                                <div class="card my-card contact-user mt-0">
                                                                    <table class="my-table no-border">
                                                                        <tr>
                                                                            <td class="picture">
                                                                                {% include '_picture.html.twig' with {'user': u, 'class': 'medium'} %}
                                                                            </td>
                                                                            <td>
                                                                                <div class="main">
                                                                                    {{ u }}
                                                                                </div>
                                                                                <div class="my-secondary">{{ u.poste }}</div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                
                                                                </div>
                                                            </a>
                                                        </div>
                                                        

                                                    {% endif %}

                                                {% endfor %}
                                            </div>
                                    </div>
                                    
                                </div>

                        </div>
                        
                    </div>
                
                </div>

                {# Events #}
                <div class="tab-pane fade" id="nav-event" role="tabpanel" aria-labelledby="nav-event-tab">

                    <div class="row">

                        <div class="col-12">

                                <div class="card my-card no-border mt-0 my-box">

                                    <div class="card-body">
                                        <h5 class="">Evénements</h5>

                                        <p class="text my-4">
                                             En cours de développement.
                                           
                                        </p>
                                    </div>
                                    
                                </div>

                        </div>
                
                    </div>
                </div>

                {% if user.adminGroupes|length > 0 and user == app.user %}

                    {# Suivi de la documentation #}
                    <div class="tab-pane fade" id="nav-admin" role="tabpanel" aria-labelledby="nav-admin-tab">


                        <div class="card my-card no-border my-box mt-0 mb-4 pb-0">
                            <div class="card-body py-0">
                                
                                <div class="row">
                                    <div class="col-6">
                                        <h5 class="pt-4">Suivi de la documentation</h5>
                                        
                                
                                    </div>
                                    <div class="col-6">
                                        <div class="form-group">
                                            <select class="form-control mt-3" id="groupe-select">
                                                <option data-path="{{ path('account_index')}}" autocomplete="off" value="" {% if groupe is null %} selected {% endif %}>-- Aucun filtre</option>

                                                {% for g in groupes %}
                                                    <option value="{{ g.id }}" data-path="{{ path('account_index_filter', {'id': g.id })}}" autocomplete="off" {% if groupe == g %} selected="selected" {% endif %}>{{ g.title }}</option>
                                                {% endfor %}

                                            </select>
                                        </div>                                    
                                    </div>
                                    <div class="col-12 pr-2 account-nav">
                                        <hr class="mb-0 mt-1">

                                        {# <nav>
                                            <div class="nav nav-tabs no-border" id="nav-tab-2" role="tablist">
                                                <a class="nav-item w-50 nav-link active btn no-br mt-1" id="nav-online-tab" data-toggle="tab" href="#nav-online" role="tab" aria-controls="nav-online" aria-selected="true">En ligne</a>
                                                <a class="nav-item w-50 nav-link btn no-br mt-1" id="nav-draft-tab" data-toggle="tab" href="#nav-draft" role="tab" aria-controls="nav-draft" aria-selected="false">Brouillons ({{ drafts|length }})</a>
                                            </div>
                                        </nav> #}

                                        {% set counter = filesToCorrect|length + filesToValidate|length + filesObsolete|length + filesWellObsolete|length + filesUpToDate|length %}

                                        <nav>
                                            <div class="nav nav-tabs no-border" id="nav-tab" role="tablist">
                                                <a class="nav-item nav-link px-3 no-br btn active" id="nav-validate-tab" data-toggle="tab" href="#nav-validate" role="tab" aria-controls="nav-validate" aria-selected="true">En attente de validation ({{ adminFilesToValidate|length }})</a>
                                                <a class="nav-item nav-link px-3 no-br btn" id="nav-correct-tab" data-toggle="tab" href="#nav-correct" role="tab" aria-controls="nav-correct" aria-selected="false">A corriger ({{ adminFilesToCorrect|length }})</a>
                                                <a class="nav-item nav-link px-3 no-br btn" id="nav-obsolete-tab" data-toggle="tab" href="#nav-obsolete" role="tab" aria-controls="nav-obsolete" aria-selected="false">Obsolètes ({{ adminFilesObsolete|length }})</a>
                                                <a class="nav-item nav-link px-3 no-br btn" id="nav-well-obsolete-tab" data-toggle="tab" href="#nav-well-obsolete" role="tab" aria-controls="nav-well-obsolete" aria-selected="false">Bientôt obsolètes ({{ adminFilesWellObsolete|length }})</a>

                                            </div>
                                        </nav>
                                        
                                        
                                        
                                        
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="tab-content" id="nav-tabContent-2">

                            <div class="tab-pane fade show active" id="nav-validate" role="tabpanel" aria-labelledby="nav-validate-tab">

                                {% if adminFilesToValidate|length > 0 %}
                            
                                {# En attente de validation #}
                                {% for file in adminFilesToValidate %}
                                    {% include 'documentation/_file.html.twig' %}
                                {% endfor %}

                                {% else %}

                                    <p class="text text-center">Aucune fiche en attente de validation</p>

                                {% endif %}

                            </div>
                            <div class="tab-pane fade" id="nav-correct" role="tabpanel" aria-labelledby="nav-correct-tab">
                            
                                {% if adminFilesToCorrect|length > 0 %}
                            
                                    {# En attente de validation #}
                                    {% for file in adminFilesToCorrect %}
                                        {% include 'documentation/_file.html.twig' %}
                                    {% endfor %}

                                {% else %}

                                    <p class="text text-center">Aucune fiche à corriger</p>

                                {% endif %}

                            </div>

                            <div class="tab-pane fade" id="nav-obsolete" role="tabpanel" aria-labelledby="nav-obsolete-tab">

                                {% if adminFilesObsolete|length > 0 %}

                                    {# Obsolète #}
                                    {% for file in adminFilesObsolete %}
                                        {% include 'documentation/_file.html.twig' %}
                                    {% endfor %}

                                {% else %}

                                    <p class="text text-center">Aucune fiche bientôt obsolète</p>

                                {% endif %}
                            </div>

                            <div class="tab-pane fade" id="nav-well-obsolete" role="tabpanel" aria-labelledby="nav-well-obsolete-tab">

                                {% if adminFilesWellObsolete|length > 0 %}

                                    {# Bientôt obsolète #}
                                    {% for file in adminFilesWellObsolete %}
                                        {% include 'documentation/_file.html.twig' %}
                                    {% endfor %}

                                {% else %}

                                    <p class="text text-center">Aucune fiche obsolète</p>

                                {% endif %}
                            </div>

                            

                        </div>

                    </div>

                {% endif %}


        </div>
    </div>


</div>

    {% if user == app.user %}
    <!-- Modal -->
    <div class="modal fade bd-example-modal-lg" id="subModalSheet" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content p-3">
        <div class="modal-header no-border pb-0">
            <h4 class="modal-title m-0" id="exampleModalLabel">Nouvelle fiche<span class="font-weight-light"> - Dans quelle sous-catégorie ?</span></h4>
            
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
            
        </div>
        {# <p class="px-3 text">Si la sous-catégorie où vous voulez ajouter la fiche n'apparaît pas, contactez votre responsable.</p> #}
        {# <p class="px-3 op-70">Voici les sous-catégories où vous êtes autorisés à ajouter une nouvelle fiche</p> #}
        <div class="modal-body">

                {% if is_granted('ROLE_ADMIN') %}
        
            <ul class="nav nav-tabs mt-0" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="my-subs-tab" data-toggle="tab" href="#my-subs" role="tab" aria-controls="my-subs" aria-selected="true">Mes sous-catégories</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="all-subs-tab" data-toggle="tab" href="#all-subs" role="tab" aria-controls="all-subs" aria-selected="false">Toutes les sous-catégories</a>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="my-subs" role="tabpanel" aria-labelledby="my-subs-tab">

                    {% set prev_pole = "" %}
                    {% for sub in app.user.subCategories|sort((a, b) => a.category.pole.title <=> b.category.pole.title) %}

                        {% set pole = sub.category.pole %}

                        {% if pole != prev_pole %}
                            <h5 class="mt-3 mb-2">{{ pole }}</h5>
                        {% endif %}

                            <div class="select-sub" data-href="{{ path('sheet_create_sub', {'id': sub.id}) }}">
                                {{ sub.category }} - {{ sub }}
                            </div>

                        {% set prev_pole = pole %}

                    {% endfor %}
                
                </div>
                <div class="tab-pane fade" id="all-subs" role="tabpanel" aria-labelledby="all-subs-tab">

                    {% for pole in allsubs.poles %}

                        <h5 class="mt-3 mb-2">{{ pole }}</h5>

                        {% for cat in pole.category %}

                            {% for sub in cat.subcategories %}
                                <div class="select-sub" data-href="{{ path('sheet_create_sub', {'id': sub.id}) }}">
                                    {{ cat }} - {{ sub }}
                                </div>
                            {% endfor %}

                        {% endfor %}


                    {% endfor %}
                
                </div>

            </div>
        {% else %}

            {% set prev_pole = "" %}
            {% for sub in app.user.subCategories|sort((a, b) => a.category.pole.title <=> b.category.pole.title) %}

                {% set pole = sub.category.pole %}

                {% if pole != prev_pole %}
                    <h5 class="mt-3 mb-2">{{ pole }}</h5>
                {% endif %}

                    <div class="select-sub" data-href="{{ path('sheet_create_sub', {'id': sub.id}) }}">
                        {{ sub.category }} - {{ sub }}
                    </div>

                {% set prev_pole = pole %}

            {% endfor %}

        {% endif %}


        </div>
        <div class="modal-footer no-border">
            
            <button type="button" class="btn rouge" data-dismiss="modal">Annuler</button>
            <a type="button" href="" class="btn btn-my-primary add disabled">C'est parti !</a>
        </div>
        </div>
    </div>
    </div>

    <div class="modal fade bd-example-modal-lg" id="subModalDocument" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content p-3">
        <div class="modal-header no-border pb-0">
            <h4 class="modal-title m-0" id="exampleModalLabel">Nouveau document<span class="font-weight-light"> - Dans quelle sous-catégorie ?</span></h4>
            
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
            
        </div>
        {# <p class="px-3 op-70">Voici les sous-catégories où vous êtes autorisés à ajouter une nouvelle fiche</p> #}
        <div class="modal-body">

            {% if is_granted('ROLE_ADMIN') %}
        
            <ul class="nav nav-tabs mt-0" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="my-subs-tab-2" data-toggle="tab" href="#my-subs" role="tab" aria-controls="my-subs-2" aria-selected="true">Mes sous-catégories</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="all-subs-tab-2" data-toggle="tab" href="#all-subs-2" role="tab" aria-controls="all-subs-2" aria-selected="false">Toutes les sous-catégories</a>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="my-subs-2" role="tabpanel" aria-labelledby="my-subs-tab">

                    {% set prev_pole = "" %}
                    {% for sub in app.user.subCategories|sort((a, b) => a.category.pole.title <=> b.category.pole.title) %}

                        {% set pole = sub.category.pole %}

                        {% if pole != prev_pole %}
                            <h5 class="mt-3 mb-2">{{ pole }}</h5>
                        {% endif %}

                            <div class="select-sub" data-href="{{ path('sheet_create_sub', {'id': sub.id}) }}">
                                {{ sub.category }} - {{ sub }}
                            </div>

                        {% set prev_pole = pole %}

                    {% endfor %}
                
                </div>
                <div class="tab-pane fade" id="all-subs-2" role="tabpanel" aria-labelledby="all-subs-tab">

                    {% for pole in allsubs.poles %}

                        <h5 class="mt-3 mb-2">{{ pole }}</h5>

                        {% for cat in pole.category %}

                            {% for sub in cat.subcategories %}
                                <div class="select-sub" data-href="{{ path('sheet_create_sub', {'id': sub.id}) }}">
                                    {{ cat }} - {{ sub }}
                                </div>
                            {% endfor %}

                        {% endfor %}


                    {% endfor %}
                
                </div>

            </div>
        {% else %}

            {% set prev_pole = "" %}
            {% for sub in app.user.subCategories|sort((a, b) => a.category.pole.title <=> b.category.pole.title) %}

                {% set pole = sub.category.pole %}

                {% if pole != prev_pole %}
                    <h5 class="mt-3 mb-2">{{ pole }}</h5>
                {% endif %}

                    <div class="select-sub" data-href="{{ path('sheet_create_sub', {'id': sub.id}) }}">
                        {{ sub.category }} - {{ sub }}
                    </div>

                {% set prev_pole = pole %}

            {% endfor %}

        {% endif %}

      </div>
        <div class="modal-footer no-border">
            <button type="button" class="btn rouge" data-dismiss="modal">Annuler</button>
            <a type="button" href="" class="btn btn-my-primary add disabled">C'est parti !</a>
        </div>
        </div>
    </div>
    </div>
    {% endif %}

{% endblock %}

{% block javascripts %}


<script>

// Liens de stabs au rafraichissement des pages 
$(document).ready(function() {
    if (location.hash) {
        $("a[href='" + location.hash + "']").tab("show");
    }
    $(document.body).on("click", "a[data-toggle='tab']", function(event) {
        location.hash = this.getAttribute("href");
    });
});
$(window).on("popstate", function() {
    var anchor = location.hash || $("a[data-toggle='tab']").first().attr("href");
    $("a[href='" + anchor + "']").tab("show");
});

$( "#groupe-select" ).change(function() {

    {# var groupe = $( "#groupe-select option:selected" ).val(); #}


    var path = $( "#groupe-select option:selected" ).data('path');

    window.location.replace(path + '#nav-admin');

    /*var path = "{{ path('account_index') }}";


            $.ajax({

                type: 'POST',
                url: path,
                data: { id: groupe},
                success: function(data) {

                    // location.reload();
                    
                },
                error: function(data) {
                    /*console.log(data);
                    alert("Error !")
                }

            });*/

});


</script>




{% endblock %}
